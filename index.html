<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Вычисление Выражений</title>
</head>
<body>
    <h1>Вычисление выражений из файла</h1>
    <button id="calculate">Вычислить выражения</button>
    <script>
        // Объект для хранения переменных
        const variables = {};

        // Функция для вывода текста в консоль
        function print(text) {
            console.log(text);
        }

        // Функция для вывода ошибки
        function error(text) {
            console.error(text);
        }

        // Функция для создания новой переменной
        function newVariable(name, value) {
            if (!isNaN(value)) {
                variables[name] = Number(value);
                print(\`Переменная \${name} создана со значением \${value}\`);
            } else {
                error(\`Значение для переменной \${name} не является числом\`);
            }
        }

        // Функция для вычисления выражений из файла
        function calculateExpressionsFromFile(filePath) {
            fetch(filePath)
                .then(response => response.text())
                .then(data => {
                    // Регулярное выражение для поиска выражений внутри <??>
                    const expressionRegex = /<\\?(.*?)\\?>/g;
                    let match;
                    while ((match = expressionRegex.exec(data)) !== null) {
                        try {
                            const expression = match[1];
                            const result = eval(expression);
                            print(\`Выражение: \${expression}, Результат: \${result}\`);
                        } catch (error) {
                            error(\`Ошибка при вычислении выражения: \${match[1]}\`);
                        }
                    }

                    // Регулярное выражение для обработки команды print
                    const printRegex = /print\\("(.*?)"\\)/g;
                    while ((match = printRegex.exec(data)) !== null) {
                        print(match[1]);
                    }

                    // Регулярное выражение для обработки команды new
                    const newRegex = /<new\\("(.*?)")>=<(.*)>/g;
                    while ((match = newRegex.exec(data)) !== null) {
                        newVariable(match[1], match[2]);
                    }
                })
                .catch(error => error('Ошибка при загрузке файла: ' + error));
        }

        // Прикрепляем событие клика к кнопке
        document.getElementById('calculate').addEventListener('click', function() {
            calculateExpressionsFromFile('server.mx');
        });
    </script>
</body>
</html>
