<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Вычисление Выражений</title>
</head>
<body>
    <h1>Вычисление выражений из файла</h1>
    <button id="calculate">Вычислить выражения</button>
    <script>
        function print(text) {
            console.log(text);
        }

        // Объект для хранения переменных
        const variables = {};

        // Функция для создания новой переменной
        function numberNew(name, value) {
            if (!isNaN(value)) {
                variables[name] = Number(value);
                console.log(\`Переменная \${name} создана со значением \${value}\`);
            } else {
                console.error(\`Значение для переменной \${name} не является числом\`);
            }
        }

        function calculateExpressionsFromFile(filePath) {
            // Используем fetch API для загрузки файла
            fetch(filePath)
                .then(response => response.text())
                .then(data => {
                    // Используем регулярное выражение для поиска всех выражений внутри <??>
                    const regex = /<\\?(.*?)\\?>/g;
                    let match;
                    while ((match = regex.exec(data)) !== null) {
                        try {
                            const expression = match[1];
                            const result = eval(expression);
                            print(\`Выражение: \${expression}, Результат: \${result}\`);
                        } catch (error) {
                            console.error(\`Ошибка при вычислении выражения: \${match[1]}\`);
                        }
                    }
                    // Добавляем обработку команды print
                    const printRegex = /print\\("(.*?)"\\)/g;
                    while ((match = printRegex.exec(data)) !== null) {
                        print(match[1]);
                    }
                    // Добавляем обработку команды numberNew
                    const numberNewRegex = /#number\\.new\\("(.+?)",\\s*(.+?)\\)/g;
                    while ((match = numberNewRegex.exec(data)) !== null) {
                        numberNew(match[1], match[2]);
                    }
                })
                .catch(error => console.error('Ошибка при загрузке файла:', error));
        }

        // Прикрепляем событие клика к кнопке
        document.getElementById('calculate').addEventListener('click', function() {
            calculateExpressionsFromFile('server.mx');
        });
    </script>
</body>
</html>
